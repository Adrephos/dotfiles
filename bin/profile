#!/run/current-system/sw/bin/bash

status=$(cat /sys/class/power_supply/BAT1/status)

get_icon() {
  if [[ "$1" == "Charging" ]]; then
    powerprofilesctl set performance;
  elif [[ "$1" == "Not charging" ]]; then
    powerprofilesctl set performance
  elif [[ "$1" == "Full" ]]; then
    powerprofilesctl set performance;
  else
    powerprofilesctl set power-saver;
  fi

  echo "Setting power profile to $(powerprofilesctl get)"
}

while true; do
  current=$(cat /sys/class/power_supply/BAT1/status)
  if [ "$current" != "$status" ]; then
    echo $current
    status=$current
    get_icon $status
  fi
  sleep 5s
done
